{% extends '../base_admin.jinja2' %}

{% block content %}
  <h1>
    {{family.last_name}} Family - View 
    <span class="ml-auto">
      <a class="btn btn-secondary" 
         data-toggle="collapse" 
         href="#details" 
         role="button">
        Show Additional Details
      </a>
      <a class="btn btn-primary" 
         href="{{request.route_url('person.add', _query={'family_id': family.id})}}">
        Add Person to Family
      </a> 
      <a class="btn btn-danger" 
         href="{{request.route_url('family.delete', family_id=family.id)}}" 
         onclick="return confirm('Are you sure you want to delete this family?');">
        Delete Family
      </a>
    </span>
  </h1>

  <div class="row">
    <div class="col-lg-4 col-sm-6 mx-auto">
      {% if family.photo_fp %}
        <img class="img img-fluid" src="{{request.static_url('msumc:app/static/img/family/' + family.photo_fp.split('/')[-1])}}" alt="Family Photo">
      {% else %}
        <img class="img img-fluid" src="{{request.static_url('msumc:app/static/img/no-image.png')}}" alt="No Image Found">
      {% endif %}
    </div>
  </div>


  <div class="collapse my-2" id="details">
    <div class="card card-body">
      <table class="table table-sm table-bordered">
        <tr>
          <th>Created on</th>
          <td><code>{{family.created_on.strftime('%m/%d/%Y %I:%M %p')}}</code></td>
        </tr>
        <tr>
          <th>Created by</th>
          <td><code>{{family.created_by}}</code></td>
        </tr>
        <tr>
          <th>ID</th>
          <td><code>{{family.id}}</code></td>
        </tr>
      </table>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-9">
      <h2>Family Details</h2>
      <form action="{{request.route_url('family.update', family_id=family.id)}}" enctype="multipart/form-data" method="POST">
        <div class="row">
          <div class="col-lg-6">
            <div class="form-group">
              <div class="custom-control custom-switch">
                <input type="checkbox" id="active" name="active" class="custom-control-input" {% if family.active %}checked{% endif %}>
                <label class="custom-control-label" for="active">Active?</label>
              </div>
            </div>
          </div>
          <div class="col-lg-6"></div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="last_name">Last Name</label>
              <input type="text" id="last_name" name="last_name" class="form-control" value="{{family.last_name or ''}}" required>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="married_on">Married On</label>
              <input type="text" id="married_on" name="married_on" class="form-control datepicker" 
                pattern="\d{2}/\d{2}/\d{4}" value="{% if family.married_on %}{{family.married_on.strftime('%m/%d/%Y')}}{% endif %}">
              <small class="form-text text-muted">If applicable. Must be of format 00/00/0000</small>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="street1">Street 1</label>
              <input type="text" id="street1" name="street1" class="form-control" value="{{family.street1 or ''}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="street2">Street 2</label>
              <input type="text" id="street2" name="street2" class="form-control" value="{{family.street2 or ''}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="city">City</label>
              <input type="text" id="city" name="city" class="form-control" value="{{family.city or ''}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="state">State</label>
              <input type="text" id="state" name="state" class="form-control" value="{{family.state or ''}}">
            </div>
          </div>
          <div class="col-lg-6">
            <div class="form-group">
              <label for="zipcode">Zipcode</label>
              <input type="text" id="zipcode" name="zipcode" class="form-control" value="{{family.zipcode or ''}}">
            </div>
          </div>
          <div class="col-lg-6"></div>
          <div class="col-lg-6">
            <div class="form-group">
              {% if family.photo_fp %}
              <label for="photo">Update Photo</label>
              {% else %}
              <label for="photo">Add Photo</label>
              {% endif %}
              <input type="file" id="photo" name="photo" class="form-control">
              <small class="form-text text-muted">Only accepts <code>.jpg</code>, <code>.jpeg</code>, and <code>.png</code> files.</small>
            </div>
          </div>
          <div class="col-12">
            <div class="form-group">
              <label for="notes">Notes</label>
              <textarea id="notes" name="notes" rows="5" class="form-control">{{family.notes or ''}}</textarea>
            </div>
          </div>
          <div class="col-12 text-right">
            <button type="submit" class="btn btn-warning">Update</button>
          </div>
        </div>
      </form>
    </div>
    <div class="col-lg-3">

      <h2>People</h2>
      {% if people|length == 0 %}
        <p>No people yet...</p>
      {% endif %}

      {% if adults_parents|length > 0 %}
      <h3>Adults/Parents</h3>
      <ul>
        {% for person in adults_parents %}
          <li><a href="{{request.route_url('person.view', person_id=person.id)}}">{{person.first_name}} {% if person.last_name != family.last_name %}(<em>{{person.last_name}}</em>){% endif %}</a></li>
        {% endfor %}
      </ul>
      {% endif %}

      {% if children|length > 0 %}
      <h3>Children</h3>
      <ul>
        {% for person in children %}
          <li><a href="{{request.route_url('person.view', person_id=person.id)}}">{{person.first_name}}</a></li>
        {% endfor %}
      </ul>
      {% endif %}

    </div>
  </div>
{% endblock content %}
